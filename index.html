<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Dashboard — Ambuja Cements vs UltraTech Cement</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts for Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- noUiSlider CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.css">
    <!-- Plotly JS -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <!-- noUiSlider JS -->
    <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom, #f0f4f8, #e0e8f0); /* Subtle gradient background */
            color: #333;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            max-width: 1440px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            padding: 30px;
            overflow: hidden; /* For smooth transitions */
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 25px;
            position: relative;
        }
        .header h2 {
            font-weight: 700;
            color: #1f77b4;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .header p {
            color: #6c757d;
            font-size: 1rem;
        }
        .header i {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 1.5rem;
            color: #ff7f0e;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            align-items: end;
            margin-bottom: 40px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s ease;
        }
        .controls:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .control-group {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        .control-group i {
            position: absolute;
            top: 35px;
            left: 15px;
            color: #6c757d;
        }
        .slider-container {
            flex: 1;
            min-width: 280px;
        }
        .form-select, .form-label {
            transition: all 0.3s ease;
        }
        .form-select {
            padding-left: 40px; /* Space for icon */
        }
        .form-select:focus {
            border-color: #1f77b4;
            box-shadow: 0 0 0 0.25rem rgba(31, 119, 180, 0.25);
        }
        .noui-connect {
            background: linear-gradient(to right, #1f77b4, #ff7f0e); /* Gradient slider */
        }
        .noui-handle {
            background: white;
            border: 2px solid #1f77b4;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: grab;
        }
        .noui-handle:active {
            cursor: grabbing;
        }
        .noui-pips {
            font-size: 12px;
            color: #6c757d;
        }
        .kpi-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 40px;
        }
        .kpi-card {
            flex: 1;
            min-width: 220px;
            background: linear-gradient(135deg, #ffffff, #f0f4f8);
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, #1f77b4, #ff7f0e);
            opacity: 0.8;
        }
        .kpi-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .kpi-card .fw-bold {
            color: #ff7f0e;
            font-size: 1.5rem;
        }
        .insights {
            background: #e9f0f8;
            border: 1px solid #c0d4e8;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: background 0.3s ease;
        }
        .insights:hover {
            background: #d8e8f8;
        }
        .insights h4 {
            color: #1f77b4;
            font-weight: 700;
            margin-bottom: 15px;
        }
        .insights div {
            margin-bottom: 15px;
            line-height: 1.7;
            font-size: 0.95rem;
        }
        .main-content {
            display: flex;
            gap: 25px;
            flex-wrap: wrap; /* Responsive */
        }
        .main-chart {
            flex: 2;
            min-width: 60%;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s ease;
        }
        .main-chart:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        #main-chart {
            height: 550px;
            width: 100%;
        }
        .side-pane {
            flex: 1;
            min-width: 35%;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s ease;
        }
        .side-pane:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .side-pane h4 {
            color: #1f77b4;
            font-weight: 700;
            margin-bottom: 20px;
        }
        #spark-chart {
            height: 280px;
            width: 100%;
        }
        #data-table {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow: auto;
            max-height: 280px;
            white-space: pre;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            transition: background 0.3s ease;
        }
        #data-table:hover {
            background: #f0f4f8;
        }
        .footer {
            text-align: center;
            color: #6c757d;
            font-size: 12px;
            margin-top: 40px;
            border-top: 2px solid #e0e0e0;
            padding-top: 20px;
        }
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            .main-content {
                flex-direction: column;
            }
            .kpi-cards {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <i class="bi bi-bar-chart-line-fill"></i>
            <h2>Financial Dashboard — Ambuja Cements vs UltraTech Cement</h2>
            <p class="text-muted">Compare liquidity, profitability, leverage, and turnover metrics (Mar-21 → Mar-25).</p>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="control-group">
                <label for="company-select" class="form-label">Company</label>
                <i class="bi bi-building"></i>
                <select id="company-select" class="form-select">
                    <option value="Ambuja Cements">Ambuja Cements</option>
                    <option value="UltraTech Cement">UltraTech Cement</option>
                    <option value="Both" selected>Both Companies</option>
                </select>
            </div>
            <div class="control-group">
                <label for="metric-group" class="form-label">Metric Group</label>
                <i class="bi bi-graph-up"></i>
                <select id="metric-group" class="form-select">
                    <option value="liquidity" selected>Liquidity Ratios</option>
                    <option value="profitability">Profitability Ratios</option>
                    <option value="leverage">Leverage Ratios</option>
                    <option value="turnover">Turnover Ratios</option>
                </select>
            </div>
            <div class="slider-container">
                <label class="form-label">Year Range</label>
                <div id="year-slider"></div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div id="kpi-cards" class="kpi-cards"></div>

        <!-- Insights -->
        <div id="insights-section" class="insights"></div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="main-chart">
                <div id="main-chart"></div>
            </div>
            <div class="side-pane">
                <h4>Mini-trend & Data</h4>
                <div id="spark-chart"></div>
                <div id="data-table"></div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            Data source: user-provided values (Mar-21 → Mar-25).
        </div>
    </div>

    <script>
        const appData = {
  "data": {
    "years": [
      "Mar-21",
      "Mar-22",
      "Mar-23",
      "Mar-24",
      "Mar-25"
    ],
    "year_numbers": [
      2021,
      2022,
      2023,
      2024,
      2025
    ],
    "ambuja": {
      "Current Ratio": [
        1.62,
        1.42,
        1.96,
        2.03,
        1.55
      ],
      "Quick Ratio": [
        1.41,
        1.22,
        1.72,
        1.79,
        1.3
      ],
      "Gross Profit Margin": [
        17.46,
        8.35,
        8.93,
        14.4,
        9.96
      ],
      "Net Profit Margin": [
        9.59,
        6.25,
        6.63,
        10.78,
        11.89
      ],
      "Interest Coverage Ratio": [
        37.14,
        19.33,
        21.63,
        21.5,
        28.46
      ],
      "Inventory Turnover": [
        10.58,
        9.26,
        11.9,
        9.19,
        8.25
      ],
      "Asset Turnover": [
        0.94,
        0.95,
        1.09,
        0.74,
        0.61
      ],
      "Trade Receivable Turnover": [
        48.0,
        36.51,
        43.26,
        28.01,
        25.0
      ]
    },
    "ultratech": {
      "Current Ratio": [
        0.37,
        0.39,
        0.42,
        0.43,
        0.44
      ],
      "Quick Ratio": [
        0.2,
        0.14,
        0.17,
        0.15,
        0.17
      ],
      "Gross Profit Margin": [
        56.22,
        50.97,
        45.01,
        48.87,
        49.03
      ],
      "Net Profit Margin": [
        12.3,
        13.69,
        7.86,
        9.97,
        8.47
      ],
      "Interest Coverage Ratio": [
        7.31,
        11.37,
        10.62,
        11.71,
        6.67
      ],
      "Inventory Turnover": [
        null,
        5.59,
        6.0,
        4.97,
        4.41
      ],
      "Asset Turnover": [
        null,
        0.86,
        1.01,
        1.07,
        0.92
      ],
      "Trade Receivable Turnover": [
        null,
        2.54,
        2.58,
        2.55,
        2.28
      ]
    }
  },
  "metric_groups": {
    "liquidity": [
      "Current Ratio",
      "Quick Ratio"
    ],
    "profitability": [
      "Gross Profit Margin",
      "Net Profit Margin"
    ],
    "turnover": [
      "Inventory Turnover",
      "Asset Turnover",
      "Trade Receivable Turnover"
    ],
    "leverage": [
      "Interest Coverage Ratio"
    ]
  },
  "metric_colors": {
    "Current Ratio": "#1f77b4",
    "Quick Ratio": "#aec7e8",
    "Gross Profit Margin": "#2ca02c",
    "Net Profit Margin": "#98df8a",
    "Interest Coverage Ratio": "#9467bd",
    "Inventory Turnover": "#ff7f0e",
    "Asset Turnover": "#ffbb78",
    "Trade Receivable Turnover": "#d62728"
  },
  "company_colors": {
    "Ambuja Cements": "#1f77b4",
    "UltraTech Cement": "#ff7f0e"
  },
  "insights": {
    "Current Ratio": "Ambuja’s 1.62 (’21) to 1.55 (’25) shows solid liquidity, peaking at 2.03 (’24), but recent dip hints at tighter operations. UltraTech’s low 0.37–0.44 signals lean liquidity, risking strain but efficient for capital-heavy cement.",
    "Quick Ratio": "Ambuja’s 1.41–1.30 (’21–’25) reflects strong immediate liquidity, though declining. UltraTech’s 0.20–0.17 shows vulnerability, prioritizing efficiency over cash reserves.",
    "Gross Profit Margin": "Ambuja’s volatile 17.46% (’21) to 9.96% (’25) suggests cost pressures, recovering to 14.40% (’24). UltraTech’s robust 56.22%–49.03% showcases superior pricing power and scale.",
    "Net Profit Margin": "Ambuja improves from 6.25% (’22) to 11.89% (’25), signaling better cost control. UltraTech peaks at 13.69% (’22) but falls to 8.47% (’25), indicating moderated profitability.",
    "Interest Coverage Ratio": "Ambuja’s strong 37.14–28.46 (’21–’25) reflects low debt risk. UltraTech’s 7.31–6.67 suggests higher leverage but manageable coverage.",
    "Inventory Turnover": "Ambuja’s 10.58–8.25 (’21–’25) shows slowing inventory movement, risking costs. UltraTech’s 5.59–4.41 (’22–’25) indicates even slower turnover, less efficient.",
    "Asset Turnover": "Ambuja’s 0.94–0.61 (’21–’25) reflects declining asset efficiency. UltraTech’s 0.86–0.92 (’22–’25) is steadier, slightly outperforming in sales generation.",
    "Trade Receivable Turnover": "Ambuja’s 48.00–25.00 (’21–’25) signals slower collections, risking cash flow. UltraTech’s 2.54–2.28 (’22–’25) is far slower, highlighting credit leniency."
  }
};

        const data = appData.data;
        const metric_groups = appData.metric_groups;
        const metric_colors = appData.metric_colors;
        const company_colors = appData.company_colors;
        const insights = appData.insights;

        // Build rows array
        const rows = [];
        for (let i = 0; i < data.years.length; i++) {
            for (let metric in data.ambuja) {
                rows.push({
                    company: 'Ambuja Cements',
                    metric: metric,
                    value: data.ambuja[metric][i],
                    yearLabel: data.years[i],
                    year: data.year_numbers[i]
                });
            }
            for (let metric in data.ultratech) {
                rows.push({
                    company: 'UltraTech Cement',
                    metric: metric,
                    value: data.ultratech[metric][i],
                    yearLabel: data.years[i],
                    year: data.year_numbers[i]
                });
            }
        }

        // Elements
        const companySelect = document.getElementById('company-select');
        const metricGroupSelect = document.getElementById('metric-group');
        const yearSlider = document.getElementById('year-slider');
        const kpiCards = document.getElementById('kpi-cards');
        const insightsSection = document.getElementById('insights-section');
        const dataTable = document.getElementById('data-table');

        // Setup slider
        noUiSlider.create(yearSlider, {
            start: [2021, 2025],
            connect: true,
            step: 1,
            range: {
                'min': 2021,
                'max': 2025
            },
            pips: {
                mode: 'values',
                values: [2021, 2022, 2023, 2024, 2025],
                density: 4
            }
        });

        // Event listeners
        companySelect.addEventListener('change', updateAll);
        metricGroupSelect.addEventListener('change', updateAll);
        yearSlider.noUiSlider.on('update', updateAll);

        function getCurrentState() {
            const company = companySelect.value;
            const group = metricGroupSelect.value;
            const [yr_min, yr_max] = yearSlider.noUiSlider.get().map(Number);
            const metrics = metric_groups[group];
            return { company, group, yr_min, yr_max, metrics };
        }

        function kpiLatest(company, metric) {
            const sub = rows.filter(r => r.company === company && r.metric === metric)
                .sort((a, b) => a.year - b.year);
            if (!sub.length) return null;
            return sub[sub.length - 1].value;
        }

        function updateKPIs() {
            const { company, metrics } = getCurrentState();
            kpiCards.innerHTML = '';
            metrics.forEach(metric => {
                let cardContent = '';
                if (company === 'Both') {
                    const a_val = kpiLatest('Ambuja Cements', metric);
                    const u_val = kpiLatest('UltraTech Cement', metric);
                    cardContent = `
                        <div>${metric}</div>
                        <div class="d-flex gap-3 mt-2">
                            <div>
                                <small class="text-muted">Ambuja</small>
                                <div class="fw-bold">${a_val !== null ? a_val.toFixed(2) : '—'}</div>
                            </div>
                            <div>
                                <small class="text-muted">UltraTech</small>
                                <div class="fw-bold">${u_val !== null ? u_val.toFixed(2) : '—'}</div>
                            </div>
                        </div>
                    `;
                } else {
                    const val = kpiLatest(company, metric);
                    cardContent = `
                        <div>${metric}</div>
                        <div class="fs-4 fw-bold mt-2">${val !== null ? val.toFixed(2) : '—'}</div>
                    `;
                }
                const card = document.createElement('div');
                card.className = 'kpi-card';
                card.innerHTML = cardContent;
                kpiCards.appendChild(card);
            });
        }

        function updateInsights() {
            const { metrics } = getCurrentState();
            insightsSection.innerHTML = '<h4>Insights for Selected Ratios</h4>';
            metrics.forEach(metric => {
                const insightDiv = document.createElement('div');
                insightDiv.innerHTML = `<strong>${metric}:</strong> ${insights[metric] || 'No insight available.'}`;
                insightDiv.style.marginBottom = '8px';
                insightsSection.appendChild(insightDiv);
            });
        }

        function updateCharts() {
            const { company, yr_min, yr_max, metrics } = getCurrentState();
            const dff = rows.filter(r => metrics.includes(r.metric) && r.year >= yr_min && r.year <= yr_max);

            // Main chart
            const mainTraces = [];
            if (company === 'Both') {
                metrics.forEach(metric => {
                    ['Ambuja Cements', 'UltraTech Cement'].forEach(comp => {
                        const s = dff.filter(r => r.metric === metric && r.company === comp)
                            .sort((a, b) => a.year - b.year);
                        const marker = { color: metric_colors[metric] || '#000000' };
                        if (comp === 'UltraTech Cement') {
                            marker.pattern = { shape: '/', fillmode: 'overlay', fgcolor: 'white', fgopacity: 0.3 };
                        }
                        mainTraces.push({
                            type: 'bar',
                            x: s.map(r => r.yearLabel),
                            y: s.map(r => r.value),
                            name: `${comp} — ${metric}`,
                            text: s.map(r => r.value !== null ? r.value.toFixed(2) : '—'),
                            textposition: 'auto',
                            marker: marker,
                            hoverinfo: 'x+y+name'
                        });
                    });
                });
                Plotly.newPlot('main-chart', mainTraces, {
                    barmode: 'group',
                    title: 'Comparison — grouped by metric & company',
                    xaxis: { title: 'Year', gridcolor: '#e0e0e0' },
                    yaxis: { title: 'Value', gridcolor: '#e0e0e0' },
                    responsive: true,
                    hovermode: 'closest',
                    legend: { orientation: 'h', y: -0.15, bgcolor: 'rgba(255,255,255,0.8)' },
                    plot_bgcolor: '#f8f9fa',
                    paper_bgcolor: 'transparent'
                });
            } else {
                metrics.forEach(metric => {
                    const s = dff.filter(r => r.company === company && r.metric === metric)
                        .sort((a, b) => a.year - b.year);
                    const marker = { color: metric_colors[metric] || '#000000' };
                    mainTraces.push({
                        type: 'bar',
                        x: s.map(r => r.yearLabel),
                        y: s.map(r => r.value),
                        name: metric,
                        text: s.map(r => r.value !== null ? r.value.toFixed(2) : '—'),
                        textposition: 'auto',
                        marker: marker,
                        hoverinfo: 'x+y+name'
                    });
                });
                Plotly.newPlot('main-chart', mainTraces, {
                    barmode: 'group',
                    title: `${company} — ${metrics[0].split(' ')[0]} Ratios`,
                    xaxis: { title: 'Year', gridcolor: '#e0e0e0' },
                    yaxis: { title: 'Value', gridcolor: '#e0e0e0' },
                    responsive: true,
                    hovermode: 'closest',
                    legend: { orientation: 'h', y: -0.15, bgcolor: 'rgba(255,255,255,0.8)' },
                    plot_bgcolor: '#f8f9fa',
                    paper_bgcolor: 'transparent'
                });
            }

            // Spark chart
            const sparkTraces = [];
            const primary = metrics[0];
            if (company === 'Both') {
                ['Ambuja Cements', 'UltraTech Cement'].forEach(comp => {
                    const s = dff.filter(r => r.metric === primary && r.company === comp)
                        .sort((a, b) => a.year - b.year);
                    sparkTraces.push({
                        type: 'scatter',
                        mode: 'lines+markers',
                        x: s.map(r => r.yearLabel),
                        y: s.map(r => r.value),
                        name: comp,
                        line: { color: company_colors[comp] || '#000000', width: 3 },
                        marker: { size: 8 }
                    });
                });
            } else {
                const s = dff.filter(r => r.metric === primary && r.company === company)
                    .sort((a, b) => a.year - b.year);
                sparkTraces.push({
                    type: 'scatter',
                    mode: 'lines+markers',
                    x: s.map(r => r.yearLabel),
                    y: s.map(r => r.value),
                    name: company,
                    line: { color: company_colors[company] || '#000000', width: 3 },
                    marker: { size: 8 }
                });
            }
            Plotly.newPlot('spark-chart', sparkTraces, {
                title: `Trend — ${primary}`,
                margin: { t: 30, b: 30, l: 40, r: 20 },
                responsive: true,
                xaxis: { gridcolor: '#e0e0e0' },
                yaxis: { gridcolor: '#e0e0e0' },
                plot_bgcolor: '#f8f9fa',
                paper_bgcolor: 'transparent'
            });
        }

        function generateCSV(dff) {
            const years = [...new Set(dff.map(r => r.yearLabel))].sort((a, b) => {
                const ya = dff.find(r => r.yearLabel === a).year;
                const yb = dff.find(r => r.yearLabel === b).year;
                return ya - yb;
            });
            const cols = [];
            dff.forEach(r => {
                const col = `${r.company},${r.metric}`;
                if (!cols.includes(col)) cols.push(col);
            });
            let csv = 'YearLabel,' + cols.join(',') + '\n';
            years.forEach(y => {
                let row = [y];
                cols.forEach(c => {
                    const [comp, met] = c.split(',');
                    const val = dff.find(r => r.yearLabel === y && r.company === comp && r.metric === met)?.value;
                    row.push(val !== null && val !== undefined ? val.toFixed(3) : '');
                });
                csv += row.join(',') + '\n';
            });
            return csv;
        }

        function updateTable() {
            const { yr_min, yr_max, metrics } = getCurrentState();
            const dff = rows.filter(r => metrics.includes(r.metric) && r.year >= yr_min && r.year <= yr_max);
            dataTable.innerText = generateCSV(dff);
        }

        function updateAll() {
            updateKPIs();
            updateInsights();
            updateCharts();
            updateTable();
        }

        // Initial update
        updateAll();
    </script>
</body>
</html>